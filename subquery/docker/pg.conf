# Configuración de memoria
shared_buffers = 1GB                    # 25% de la RAM total
work_mem = 12MB                          # Memoria para operaciones de ordenación y joins
maintenance_work_mem = 128MB            # Memoria para tareas de mantenimiento

# Configuración de cache y planificación
effective_cache_size = 3GB              # Aproximadamente 75% de la memoria disponible
random_page_cost = 1.1                  # Optimizado para SSD; aumentar para HDD
seq_page_cost = 1.0

# Configuración de conexiones
max_connections = 50                    # Ajustar según la carga; evita demasiadas conexiones
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4

# Autovacuum
autovacuum = on                         # Mantener autovacuum activo
autovacuum_naptime = 20s                # Intervalo entre verificaciones de autovacuum
autovacuum_vacuum_scale_factor = 0.2    # Activar vacuum si cambia el 20% de las filas
autovacuum_analyze_scale_factor = 0.1   # Activar analyze si cambia el 10% de las filas
autovacuum_max_workers = 2

# Configuración de checkpoints
checkpoint_timeout = 10min              # Frecuencia de checkpoints reducida para evitar I/O intenso
checkpoint_completion_target = 0.7      # Controla el tiempo de los checkpoints
max_wal_size = 2GB                      # Máximo tamaño de Write-Ahead Logging (WAL)
min_wal_size = 512MB

# Configuración de logs
logging_collector = on                  # Habilitar el recolector de logs
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d.log'
log_statement = 'none'                  # Logea solo DDL o errores; puedes cambiar a 'mod' si necesitas logs detallados
log_min_duration_statement = 1000       # Logea consultas que tarden más de 1000 ms (1 segundo)

# Configuración de red
listen_addresses = '*'                  # Permitir conexiones desde cualquier IP
port = 5432

# Configuración para ajustes paralelos (limitado a recursos de la máquina)
parallel_setup_cost = 1000
parallel_tuple_cost = 0.1